---
layout: post
title: linux多线程服务端编程
categories: [多线程, c++]
---

## 线程安全的对象生命期管理

### 析构函数遇到多线程

c++ 要求程序员自己管理对象的生命期。这在多线程环境下显得尤为困难。当一个对象能被多个线程同时看到时，那么对象的销毁时机就会变得模糊不清，可能出现多种**竞态条件**。

> 试图以 **shared_ptr** 一劳永逸的解决这些问题。

#### 线程安全的定义

一个线程安全的 **class** 应该满足三个条件：

1. 多个线程同时访问时，其表现出正确的行为。
2. 无论操作系统如何调度这些线程，无论这些线程的执行顺序如何交织。
3. 调用端代码无需额外的同步或其他协调动作。

根据这个定义，c++标准库中的大多数class都不是线程安全的，包括std::string, std::vector，因为这些class通常需要在外部加锁才能供多个线程同时访问。


